module.exports = {

"[project]/apps/web/.next-internal/server/app/api/auth/[...nextauth]/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/child_process [external] (child_process, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/fs/promises [external] (fs/promises, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}}),
"[externals]/async_hooks [external] (async_hooks, cjs)": ((__turbopack_context__) => {

var { m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("async_hooks", () => require("async_hooks"));

module.exports = mod;
}}),
"[project]/packages/database/index.ts [app-route] (ecmascript) <locals>": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "prisma": ()=>prisma
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$prisma$2b$client$40$5$2e$22$2e$0_prisma$40$5$2e$22$2e$0$2f$node_modules$2f40$prisma$2f$client$2f$default$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@prisma+client@5.22.0_prisma@5.22.0/node_modules/@prisma/client/default.js [app-route] (ecmascript)");
;
const globalForPrisma = globalThis;
const prisma = globalForPrisma.prisma ?? new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$prisma$2b$client$40$5$2e$22$2e$0_prisma$40$5$2e$22$2e$0$2f$node_modules$2f40$prisma$2f$client$2f$default$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaClient"]({
    log: [
        'query'
    ]
});
if ("TURBOPACK compile-time truthy", 1) globalForPrisma.prisma = prisma;
;
}),
"[project]/packages/database/index.ts [app-route] (ecmascript) <module evaluation>": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({});
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/packages/database/index.ts [app-route] (ecmascript) <locals>");
}),
"[project]/apps/web/src/lib/jwt.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "cleanupExpiredTokens": ()=>cleanupExpiredTokens,
    "generateAccessToken": ()=>generateAccessToken,
    "generateRefreshToken": ()=>generateRefreshToken,
    "refreshAccessToken": ()=>refreshAccessToken,
    "revokeAllRefreshTokens": ()=>revokeAllRefreshTokens,
    "revokeRefreshToken": ()=>revokeRefreshToken,
    "verifyAccessToken": ()=>verifyAccessToken,
    "verifyRefreshToken": ()=>verifyRefreshToken
});
(()=>{
    const e = new Error("Cannot find module 'jsonwebtoken'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/packages/database/index.ts [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/packages/database/index.ts [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/crypto [external] (crypto, cjs)");
;
;
;
const JWT_SECRET = process.env.NEXTAUTH_SECRET || 'fallback-secret';
const REFRESH_TOKEN_SECRET = process.env.REFRESH_TOKEN_SECRET || 'refresh-secret';
function generateAccessToken(payload) {
    return jwt.sign(payload, JWT_SECRET, {
        expiresIn: '15m',
        issuer: 'griffe-platform',
        audience: 'griffe-users'
    });
}
async function generateRefreshToken(userId) {
    // Generar token único
    const token = __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["default"].randomBytes(64).toString('hex');
    // Calcular fecha de expiración (30 días)
    const expires = new Date();
    expires.setDate(expires.getDate() + 30);
    // Guardar en base de datos
    const refreshToken = await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.create({
        data: {
            token,
            userId,
            expires
        }
    });
    // Crear JWT con el ID del refresh token
    const refreshJWT = jwt.sign({
        userId,
        tokenId: refreshToken.id
    }, REFRESH_TOKEN_SECRET, {
        expiresIn: '30d',
        issuer: 'griffe-platform',
        audience: 'griffe-refresh'
    });
    return refreshJWT;
}
function verifyAccessToken(token) {
    try {
        const decoded = jwt.verify(token, JWT_SECRET, {
            issuer: 'griffe-platform',
            audience: 'griffe-users'
        });
        return decoded;
    } catch (error) {
        return null;
    }
}
async function verifyRefreshToken(token) {
    try {
        const decoded = jwt.verify(token, REFRESH_TOKEN_SECRET, {
            issuer: 'griffe-platform',
            audience: 'griffe-refresh'
        });
        // Verificar que el token existe en la base de datos y no ha expirado
        const refreshToken = await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.findUnique({
            where: {
                id: decoded.tokenId
            },
            include: {
                user: true
            }
        });
        if (!refreshToken || refreshToken.expires < new Date()) {
            // Token expirado o no existe, eliminarlo si existe
            if (refreshToken) {
                await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.delete({
                    where: {
                        id: decoded.tokenId
                    }
                });
            }
            return null;
        }
        return {
            userId: decoded.userId,
            tokenId: decoded.tokenId
        };
    } catch (error) {
        return null;
    }
}
async function refreshAccessToken(refreshToken) {
    const tokenData = await verifyRefreshToken(refreshToken);
    if (!tokenData) {
        return null;
    }
    // Obtener datos del usuario
    const user = await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].user.findUnique({
        where: {
            id: tokenData.userId
        },
        include: {
            store: true
        }
    });
    if (!user) {
        return null;
    }
    // Generar nuevo access token
    const newAccessToken = generateAccessToken({
        userId: user.id,
        email: user.email,
        role: user.role,
        storeId: user.storeId
    });
    // Generar nuevo refresh token (rotación de tokens)
    await revokeRefreshToken(tokenData.tokenId);
    const newRefreshToken = await generateRefreshToken(user.id);
    return {
        accessToken: newAccessToken,
        refreshToken: newRefreshToken
    };
}
async function revokeRefreshToken(tokenId) {
    try {
        await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.delete({
            where: {
                id: tokenId
            }
        });
    } catch (error) {
    // Token ya eliminado o no existe
    }
}
async function revokeAllRefreshTokens(userId) {
    await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.deleteMany({
        where: {
            userId
        }
    });
}
async function cleanupExpiredTokens() {
    const now = new Date();
    await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].refreshToken.deleteMany({
        where: {
            expires: {
                lt: now
            }
        }
    });
    await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].passwordResetToken.deleteMany({
        where: {
            expires: {
                lt: now
            }
        }
    });
}
}),
"[project]/apps/web/src/lib/email.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "getPasswordResetEmailTemplate": ()=>getPasswordResetEmailTemplate,
    "getWelcomeEmailTemplate": ()=>getWelcomeEmailTemplate,
    "sendEmail": ()=>sendEmail,
    "sendPasswordResetEmail": ()=>sendPasswordResetEmail,
    "sendWelcomeEmail": ()=>sendWelcomeEmail
});
(()=>{
    const e = new Error("Cannot find module 'nodemailer'");
    e.code = 'MODULE_NOT_FOUND';
    throw e;
})();
;
// Configuración del transportador de email
const transporter = nodemailer.createTransporter({
    host: process.env.SMTP_HOST || 'smtp.gmail.com',
    port: parseInt(process.env.SMTP_PORT || '587'),
    secure: false,
    auth: {
        user: process.env.SMTP_USER,
        pass: process.env.SMTP_PASSWORD
    }
});
async function sendEmail(options) {
    try {
        if (!process.env.SMTP_USER || !process.env.SMTP_PASSWORD) {
            console.warn('SMTP credentials not configured. Email not sent.');
            return false;
        }
        await transporter.sendMail({
            from: `"GRIFFE Platform" <${process.env.SMTP_USER}>`,
            to: options.to,
            subject: options.subject,
            html: options.html,
            text: options.text
        });
        return true;
    } catch (error) {
        console.error('Error sending email:', error);
        return false;
    }
}
function getPasswordResetEmailTemplate(resetUrl, userName) {
    const html = `
    <!DOCTYPE html>
    <html lang="es">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Recuperar Contraseña - GRIFFE</title>
      <style>
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          text-align: center;
          padding: 20px 0;
          border-bottom: 2px solid #f0f0f0;
        }
        .logo {
          font-size: 24px;
          font-weight: bold;
          color: #2563eb;
        }
        .content {
          padding: 30px 0;
        }
        .button {
          display: inline-block;
          padding: 12px 24px;
          background-color: #2563eb;
          color: white;
          text-decoration: none;
          border-radius: 6px;
          font-weight: 500;
          margin: 20px 0;
        }
        .footer {
          text-align: center;
          padding: 20px 0;
          border-top: 1px solid #f0f0f0;
          color: #666;
          font-size: 14px;
        }
        .warning {
          background-color: #fef3c7;
          border: 1px solid #f59e0b;
          border-radius: 6px;
          padding: 15px;
          margin: 20px 0;
        }
      </style>
    </head>
    <body>
      <div class="header">
        <div class="logo">GRIFFE</div>
      </div>
      
      <div class="content">
        <h2>Recuperar Contraseña</h2>
        
        ${userName ? `<p>Hola ${userName},</p>` : '<p>Hola,</p>'}
        
        <p>Hemos recibido una solicitud para restablecer la contraseña de tu cuenta en GRIFFE Platform.</p>
        
        <p>Para crear una nueva contraseña, haz clic en el siguiente enlace:</p>
        
        <div style="text-align: center;">
          <a href="${resetUrl}" class="button">Restablecer Contraseña</a>
        </div>
        
        <div class="warning">
          <strong>⚠️ Importante:</strong>
          <ul>
            <li>Este enlace expirará en 1 hora por seguridad</li>
            <li>Si no solicitaste este cambio, puedes ignorar este email</li>
            <li>Tu contraseña actual seguirá siendo válida hasta que la cambies</li>
          </ul>
        </div>
        
        <p>Si tienes problemas con el enlace, copia y pega la siguiente URL en tu navegador:</p>
        <p style="word-break: break-all; color: #666; font-size: 14px;">${resetUrl}</p>
      </div>
      
      <div class="footer">
        <p>Este email fue enviado desde GRIFFE Platform</p>
        <p>Si no solicitaste este cambio, contacta con nuestro soporte</p>
      </div>
    </body>
    </html>
  `;
    const text = `
    GRIFFE - Recuperar Contraseña
    
    ${userName ? `Hola ${userName},` : 'Hola,'}
    
    Hemos recibido una solicitud para restablecer la contraseña de tu cuenta en GRIFFE Platform.
    
    Para crear una nueva contraseña, visita el siguiente enlace:
    ${resetUrl}
    
    IMPORTANTE:
    - Este enlace expirará en 1 hora por seguridad
    - Si no solicitaste este cambio, puedes ignorar este email
    - Tu contraseña actual seguirá siendo válida hasta que la cambies
    
    Si tienes problemas, contacta con nuestro soporte.
    
    GRIFFE Platform
  `;
    return {
        html,
        text
    };
}
function getWelcomeEmailTemplate(userName, loginUrl) {
    const html = `
    <!DOCTYPE html>
    <html lang="es">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Bienvenido a GRIFFE</title>
      <style>
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
          line-height: 1.6;
          color: #333;
          max-width: 600px;
          margin: 0 auto;
          padding: 20px;
        }
        .header {
          text-align: center;
          padding: 20px 0;
          border-bottom: 2px solid #f0f0f0;
        }
        .logo {
          font-size: 24px;
          font-weight: bold;
          color: #2563eb;
        }
        .content {
          padding: 30px 0;
        }
        .button {
          display: inline-block;
          padding: 12px 24px;
          background-color: #2563eb;
          color: white;
          text-decoration: none;
          border-radius: 6px;
          font-weight: 500;
          margin: 20px 0;
        }
        .footer {
          text-align: center;
          padding: 20px 0;
          border-top: 1px solid #f0f0f0;
          color: #666;
          font-size: 14px;
        }
      </style>
    </head>
    <body>
      <div class="header">
        <div class="logo">GRIFFE</div>
      </div>
      
      <div class="content">
        <h2>¡Bienvenido a GRIFFE Platform!</h2>
        
        <p>Hola ${userName},</p>
        
        <p>¡Tu cuenta ha sido creada exitosamente! Estamos emocionados de tenerte en nuestra plataforma.</p>
        
        <p>Ya puedes acceder a tu dashboard y comenzar a gestionar tu tienda:</p>
        
        <div style="text-align: center;">
          <a href="${loginUrl}" class="button">Acceder a mi Dashboard</a>
        </div>
        
        <p>Si tienes alguna pregunta o necesitas ayuda, no dudes en contactarnos.</p>
        
        <p>¡Gracias por elegir GRIFFE!</p>
      </div>
      
      <div class="footer">
        <p>GRIFFE Platform - Tu socio en el comercio digital</p>
      </div>
    </body>
    </html>
  `;
    const text = `
    ¡Bienvenido a GRIFFE Platform!
    
    Hola ${userName},
    
    ¡Tu cuenta ha sido creada exitosamente! Estamos emocionados de tenerte en nuestra plataforma.
    
    Ya puedes acceder a tu dashboard y comenzar a gestionar tu tienda:
    ${loginUrl}
    
    Si tienes alguna pregunta o necesitas ayuda, no dudes en contactarnos.
    
    ¡Gracias por elegir GRIFFE!
    
    GRIFFE Platform - Tu socio en el comercio digital
  `;
    return {
        html,
        text
    };
}
async function sendPasswordResetEmail(email, resetUrl, userName) {
    const { html, text } = getPasswordResetEmailTemplate(resetUrl, userName);
    return await sendEmail({
        to: email,
        subject: 'Recuperar Contraseña - GRIFFE Platform',
        html,
        text
    });
}
async function sendWelcomeEmail(email, userName, loginUrl) {
    const { html, text } = getWelcomeEmailTemplate(userName, loginUrl);
    return await sendEmail({
        to: email,
        subject: '¡Bienvenido a GRIFFE Platform!',
        html,
        text
    });
}
}),
"[project]/apps/web/src/lib/auth.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "authOptions": ()=>authOptions
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$auth$2b$prisma$2d$adapter$40$2$2e$10$2e$0_$40$prisma$2b$client$40$5$2e$22$2e$0_prisma$40$5$2e$22$2e$0_$2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/@auth+prisma-adapter@2.10.0_@prisma+client@5.22.0_prisma@5.22.0_/node_modules/@auth/prisma-adapter/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next-auth@4.24.11_next@15.4.5_@babel+core@7.28.0_react-dom@19.1.0_react@19.1.0__react@1_f70a4850866825c2f3784a61620a6da9/node_modules/next-auth/providers/credentials.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next-auth@4.24.11_next@15.4.5_@babel+core@7.28.0_react-dom@19.1.0_react@19.1.0__react@1_f70a4850866825c2f3784a61620a6da9/node_modules/next-auth/providers/google.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/packages/database/index.ts [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/packages/database/index.ts [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$bcryptjs$40$2$2e$4$2e$3$2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/bcryptjs@2.4.3/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$3$2e$25$2e$76$2f$node_modules$2f$zod$2f$v3$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/zod@3.25.76/node_modules/zod/v3/external.js [app-route] (ecmascript) <export * as z>");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$jwt$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/web/src/lib/jwt.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$email$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/web/src/lib/email.ts [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
const loginSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$3$2e$25$2e$76$2f$node_modules$2f$zod$2f$v3$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].object({
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$3$2e$25$2e$76$2f$node_modules$2f$zod$2f$v3$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().email(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$zod$40$3$2e$25$2e$76$2f$node_modules$2f$zod$2f$v3$2f$external$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__$2a$__as__z$3e$__["z"].string().min(6)
});
const authOptions = {
    adapter: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f40$auth$2b$prisma$2d$adapter$40$2$2e$10$2e$0_$40$prisma$2b$client$40$5$2e$22$2e$0_prisma$40$5$2e$22$2e$0_$2f$node_modules$2f40$auth$2f$prisma$2d$adapter$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PrismaAdapter"])(__TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"]),
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            name: 'credentials',
            credentials: {
                email: {
                    label: 'Email',
                    type: 'email'
                },
                password: {
                    label: 'Password',
                    type: 'password'
                }
            },
            async authorize (credentials) {
                try {
                    const { email, password } = loginSchema.parse(credentials);
                    const user = await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].user.findUnique({
                        where: {
                            email
                        },
                        include: {
                            store: true
                        }
                    });
                    if (!user || !user.password) {
                        return null;
                    }
                    const isPasswordValid = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$bcryptjs$40$2$2e$4$2e$3$2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].compare(password, user.password);
                    if (!isPasswordValid) {
                        return null;
                    }
                    return {
                        id: user.id,
                        email: user.email,
                        name: user.name,
                        role: user.role,
                        storeId: user.storeId,
                        store: user.store
                    };
                } catch (error) {
                    console.error('Auth error:', error);
                    return null;
                }
            }
        }),
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$providers$2f$google$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            clientId: process.env.GOOGLE_CLIENT_ID,
            clientSecret: process.env.GOOGLE_CLIENT_SECRET
        })
    ],
    session: {
        strategy: 'jwt',
        maxAge: 15 * 60
    },
    jwt: {
        maxAge: 15 * 60
    },
    callbacks: {
        async jwt ({ token, user, account }) {
            if (user && account) {
                // Primera vez que el usuario se autentica
                token.role = user.role;
                token.storeId = user.storeId;
                token.store = user.store;
                // Generar refresh token para el usuario
                try {
                    const refreshToken = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$jwt$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateRefreshToken"])(user.id);
                    token.refreshToken = refreshToken;
                } catch (error) {
                    console.error('Error generating refresh token:', error);
                }
            }
            return token;
        },
        async session ({ session, token }) {
            if (token && session.user) {
                session.user.id = token.sub;
                session.user.role = token.role;
                session.user.storeId = token.storeId;
                session.user.store = token.store;
                session.refreshToken = token.refreshToken;
            }
            return session;
        },
        async signIn ({ user, account, profile }) {
            // Enviar email de bienvenida para nuevos usuarios de Google
            if (account?.provider === 'google' && user.email) {
                try {
                    const existingUser = await __TURBOPACK__imported__module__$5b$project$5d2f$packages$2f$database$2f$index$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__["prisma"].user.findUnique({
                        where: {
                            email: user.email
                        }
                    });
                    if (!existingUser) {
                        // Nuevo usuario, enviar email de bienvenida
                        const baseUrl = process.env.NEXTAUTH_URL || 'http://localhost:3002';
                        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$email$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sendWelcomeEmail"])(user.email, user.name || 'Usuario', `${baseUrl}/auth/login`);
                    }
                } catch (error) {
                    console.error('Error sending welcome email:', error);
                }
            }
            return true;
        },
        async redirect ({ url, baseUrl }) {
            // Permite redirecciones relativas
            if (url.startsWith('/')) return `${baseUrl}${url}`;
            else if (new URL(url).origin === baseUrl) return url;
            return baseUrl;
        }
    },
    pages: {
        signIn: '/auth/login',
        error: '/auth/error'
    },
    secret: process.env.NEXTAUTH_SECRET
};
}),
"[project]/apps/web/src/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s({
    "GET": ()=>handler,
    "POST": ()=>handler
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/.pnpm/next-auth@4.24.11_next@15.4.5_@babel+core@7.28.0_react-dom@19.1.0_react@19.1.0__react@1_f70a4850866825c2f3784a61620a6da9/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/apps/web/src/lib/auth.ts [app-route] (ecmascript)");
;
;
const handler = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f2e$pnpm$2f$next$2d$auth$40$4$2e$24$2e$11_next$40$15$2e$4$2e$5_$40$babel$2b$core$40$7$2e$28$2e$0_react$2d$dom$40$19$2e$1$2e$0_react$40$19$2e$1$2e$0_$5f$react$40$1_f70a4850866825c2f3784a61620a6da9$2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(__TURBOPACK__imported__module__$5b$project$5d2f$apps$2f$web$2f$src$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
;
}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__ca9ce28e._.js.map